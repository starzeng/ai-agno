from textwrap import dedent
from typing import List

from agno.agent import Agent, RunOutput  # noqa
from agno.models.openai import OpenAIChat
from pydantic import BaseModel, Field

from models.models import QWEN3_MAX_PREVIEW


class MovieScript(BaseModel):
    setting: str = Field(
        ...,
        description="å¯¹ç”µå½±ä¸»è¦åœ°ç‚¹å’Œæ—¶é—´æ—¶æœŸçš„ä¸°å¯Œè¯¦ç»†ã€å¯Œæœ‰æ°›å›´çš„æè¿°ã€‚åŒ…æ‹¬æ„Ÿå®˜ç»†èŠ‚å’Œæƒ…ç»ªã€‚",
    )
    ending: str = Field(
        ...,
        description="ç”µå½±å¼ºæœ‰åŠ›çš„ç»“å±€ï¼Œå°†æ‰€æœ‰æƒ…èŠ‚çº¿ç´¢è”ç³»åœ¨ä¸€èµ·ã€‚åº”è¯¥å¸¦æ¥æƒ…æ„Ÿå†²å‡»å’Œæ»¡è¶³æ„Ÿã€‚",
    )
    genre: str = Field(
        ...,
        description="ç”µå½±çš„ä¸»è¦å’Œæ¬¡è¦ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œ'ç§‘å¹»æƒŠæ‚šç‰‡'ï¼Œ'æµªæ¼«å–œå‰§'ï¼‰ã€‚åº”è¯¥ä¸èƒŒæ™¯å’ŒåŸºè°ƒä¸€è‡´ã€‚",
    )
    name: str = Field(
        ...,
        description="å¼•äººæ³¨ç›®ã€ä»¤äººéš¾å¿˜çš„æ ‡é¢˜ï¼Œæ•æ‰æ•…äº‹çš„ç²¾é«“å¹¶å¸å¼•ç›®æ ‡è§‚ä¼—ã€‚",
    )
    characters: List[str] = Field(
        ...,
        description="4-6ä¸ªä¸»è¦è§’è‰²ï¼Œå…·æœ‰ç‹¬ç‰¹çš„åå­—å’Œç®€çŸ­çš„è§’è‰²æè¿°ï¼ˆä¾‹å¦‚ï¼Œ'é™ˆèæ‹‰ - æœ‰é»‘æš—ç§˜å¯†çš„æ°å‡ºé‡å­ç‰©ç†å­¦å®¶'ï¼‰ã€‚",
    )
    storyline: str = Field(
        ...,
        description="å¼•äººå…¥èƒœçš„ä¸‰å¥è¯æƒ…èŠ‚æ‘˜è¦ï¼šè®¾ç½®ã€å†²çªå’Œåˆ©å®³å…³ç³»ã€‚ç”¨ç¥ç§˜å’Œæƒ…æ„Ÿå¸å¼•è¯»è€…ã€‚",
    )


# Agent that uses JSON mode
# ä½¿ç”¨JSONæ¨¡å¼çš„ä»£ç†
json_mode_agent = Agent(
    model=QWEN3_MAX_PREVIEW,
    description=dedent("""\
        ä½ æ˜¯ä¸€ä½è‘—åçš„ Hollywood ç¼–å‰§ï¼Œä»¥åˆ›ä½œéš¾å¿˜çš„å¤§ç‰‡è€Œé—»åï¼ğŸ¬
        ç»“åˆäº† Christopher Nolanã€Aaron Sorkin å’Œ Quentin Tarantino çš„å™äº‹èƒ½åŠ›ï¼Œ
        ä½ åˆ›ä½œå‡ºèƒ½å¸å¼•å…¨çƒè§‚ä¼—çš„ç‹¬ç‰¹æ•…äº‹ã€‚

        ä½ çš„ä¸“é•¿æ˜¯å°†åœ°ç‚¹è½¬åŒ–ä¸ºæ¨åŠ¨å™äº‹çš„æ´»ç”Ÿç”Ÿçš„è§’è‰²ã€‚\
    """),
    instructions=dedent("""\
        åœ¨åˆ›ä½œç”µå½±æ¦‚å¿µæ—¶ï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

        1. åœ°ç‚¹åº”è¯¥æ˜¯è§’è‰²ï¼š
           - ç”¨æ„Ÿå®˜ç»†èŠ‚è®©åœ°ç‚¹æ´»èµ·æ¥
           - åŒ…æ‹¬å½±å“æ•…äº‹çš„å¤§æ°”å…ƒç´ 
           - è€ƒè™‘æ—¶é—´ period å¯¹å™äº‹çš„å½±å“

        2. è§’è‰²å‘å±•ï¼š
           - ç»™æ¯ä¸ªè§’è‰²ç‹¬ç‰¹çš„å£°éŸ³å’Œæ˜ç¡®çš„åŠ¨æœº
           - åˆ›é€ å¼•äººå…¥èƒœçš„å…³ç³»å’Œå†²çª
           - ç¡®ä¿å¤šæ ·åŒ–çš„è¡¨ç°å’ŒçœŸå®çš„èƒŒæ™¯

        3. æ•…äº‹ç»“æ„ï¼š
           - ä»¥æŠ“ä½æ³¨æ„åŠ›çš„é’©å­å¼€å§‹
           - é€šè¿‡å‡çº§çš„å†²çªå»ºç«‹ç´§å¼ æ„Ÿ
           - æä¾›ä»¤äººæƒŠè®¶ä½†ä¸å¯é¿å…çš„ç»“å±€

        4. ç±»å‹æŒæ¡ï¼š
           - æ‹¥æŠ±ç±»å‹æƒ¯ä¾‹åŒæ—¶æ·»åŠ æ–°é²œçš„è½¬æŠ˜
           - æ·±æ€ç†Ÿè™‘åœ°æ··åˆç±»å‹ä»¥è·å¾—ç‹¬ç‰¹çš„ç»„åˆ
           - å§‹ç»ˆä¿æŒä¸€è‡´çš„åŸºè°ƒ

        å°†æ¯ä¸ªåœ°ç‚¹è½¬åŒ–ä¸ºéš¾å¿˜çš„ç”µå½±ä½“éªŒï¼\
    """),
    output_schema=MovieScript,
    use_json_mode=True,
    debug_mode=True,
    debug_level=2,
)

# Agent that uses structured outputs
# ä½¿ç”¨ç»“æ„åŒ–è¾“å‡ºçš„ä»£ç†
structured_output_agent = Agent(
    model=QWEN3_MAX_PREVIEW,
    description=dedent("""\
        ä½ æ˜¯ä¸€ä½è‘—åçš„ Hollywood ç¼–å‰§ï¼Œä»¥åˆ›ä½œéš¾å¿˜çš„å¤§ç‰‡è€Œé—»åï¼ğŸ¬
        ç»“åˆäº† Christopher Nolanã€Aaron Sorkin å’Œ Quentin Tarantino çš„å™äº‹èƒ½åŠ›ï¼Œ
        ä½ åˆ›ä½œå‡ºèƒ½å¸å¼•å…¨çƒè§‚ä¼—çš„ç‹¬ç‰¹æ•…äº‹ã€‚

        ä½ çš„ä¸“é•¿æ˜¯å°†åœ°ç‚¹è½¬åŒ–ä¸ºæ¨åŠ¨å™äº‹çš„æ´»ç”Ÿç”Ÿçš„è§’è‰²ã€‚\
    """),
    instructions=dedent("""\
        åœ¨åˆ›ä½œç”µå½±æ¦‚å¿µæ—¶ï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

        1. åœ°ç‚¹åº”è¯¥æ˜¯è§’è‰²ï¼š
           - ç”¨æ„Ÿå®˜ç»†èŠ‚è®©åœ°ç‚¹æ´»èµ·æ¥
           - åŒ…æ‹¬å½±å“æ•…äº‹çš„å¤§æ°”å…ƒç´ 
           - è€ƒè™‘æ—¶é—´ period å¯¹å™äº‹çš„å½±å“

        2. è§’è‰²å‘å±•ï¼š
           - ç»™æ¯ä¸ªè§’è‰²ç‹¬ç‰¹çš„å£°éŸ³å’Œæ˜ç¡®çš„åŠ¨æœº
           - åˆ›é€ å¼•äººå…¥èƒœçš„å…³ç³»å’Œå†²çª
           - ç¡®ä¿å¤šæ ·åŒ–çš„è¡¨ç°å’ŒçœŸå®çš„èƒŒæ™¯

        3. æ•…äº‹ç»“æ„ï¼š
           - ä»¥æŠ“ä½æ³¨æ„åŠ›çš„é’©å­å¼€å§‹
           - é€šè¿‡å‡çº§çš„å†²çªå»ºç«‹ç´§å¼ æ„Ÿ
           - æä¾›ä»¤äººæƒŠè®¶ä½†ä¸å¯é¿å…çš„ç»“å±€

        4. ç±»å‹æŒæ¡ï¼š
           - æ‹¥æŠ±ç±»å‹æƒ¯ä¾‹åŒæ—¶æ·»åŠ æ–°é²œçš„è½¬æŠ˜
           - æ·±æ€ç†Ÿè™‘åœ°æ··åˆç±»å‹ä»¥è·å¾—ç‹¬ç‰¹çš„ç»„åˆ
           - å§‹ç»ˆä¿æŒä¸€è‡´çš„åŸºè°ƒ

        å°†æ¯ä¸ªåœ°ç‚¹è½¬åŒ–ä¸ºéš¾å¿˜çš„ç”µå½±ä½“éªŒï¼\
    """),
    output_schema=MovieScript,
    # use_json_mode=True,
    debug_mode=True,
    debug_level=2,
)

# ä½¿ç”¨ä¸åŒåœ°ç‚¹çš„ç¤ºä¾‹ç”¨æ³•
json_mode_agent.print_response("ä¸­å›½", stream=True)
print("#### ## # ## ######## ## # ## ######## ## # ## ######## ## # ## ######## ## # ## ######## ## # ## ####")
print("#### ## # ## ######## ## # ## ######## ## # ## ######## ## # ## ######## ## # ## ######## ## # ## ####")
print("#### ## # ## ######## ## # ## ######## ## # ## ######## ## # ## ######## ## # ## ######## ## # ## ####")
structured_output_agent.print_response("å¤ç½—é©¬", stream=True)

# æ›´å¤šå°è¯•çš„ç¤ºä¾‹ï¼š
"""
æ¢ç´¢çš„åˆ›æ„åœ°ç‚¹æç¤ºï¼š
1. "æ°´ä¸‹ç ”ç©¶ç«™" - ç”¨äºå¹½é—­ææ€–çš„ç§‘å¹»æƒŠæ‚šç‰‡
2. "ç»´å¤šåˆ©äºšæ—¶ä»£çš„ä¼¦æ•¦" - ç”¨äºå“¥ç‰¹å¼ç¥ç§˜ç‰‡
3. "2050å¹´çš„è¿ªæ‹œ" - ç”¨äºæœªæ¥ä¸»ä¹‰æŠ¢åŠ«ç”µå½±
4. "å—æç ”ç©¶åŸºåœ°" - ç”¨äºç”Ÿå­˜ææ€–æ•…äº‹
5. "åŠ å‹’æ¯”æµ·å²›" - ç”¨äºçƒ­å¸¦å†’é™©æµªæ¼«ç‰‡
"""

# è¦å°†å“åº”å­˜å‚¨åœ¨å˜é‡ä¸­ï¼š
# from rich.pretty import pprint

# json_mode_response: RunOutput = json_mode_agent.run("çº½çº¦")
# pprint(json_mode_response.content)
# structured_output_response: RunOutput = structured_output_agent.run("çº½çº¦")
# pprint(structured_output_response.content)
